<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--<head th:replace="layouts :: header">-->
<head>
<!--    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>PROTON</title>
    <script src="/js/jquery-3.5.0.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="/css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="/css/style.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="/css/addons/datatables.min.css" rel="stylesheet">
    <!-- DataTables JS -->
    <script src="/js/addons/datatables.min.js" type="text/javascript"></script>

    <!-- DataTables Select CSS -->
    <link href="/css/addons/datatables-select.min.css" rel="stylesheet">
    <!-- DataTables Select JS -->
    <script src="/js/addons/datatables-select.min.js" type="text/javascript"></script>
    <!-- Bootstrap tooltips -->

    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <!--    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.colVis.min.js"></script>
    <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.dataTables.min.css"/>
</head>

<body>

<nav th:replace="layouts :: navbar"></nav>

<hr>
<h3> Project Status Reports </h3>
<hr>


<button id="ALL" class="btn btn-sm btn-amber btn-rounded" onclick="reset()">ALL</button>
<button id="CL" class="btn btn-sm btn-teal btn-rounded" onclick="filter('CL')">CL</button>
<button id="CNL" class="btn btn-sm btn-green btn-rounded" onclick="filter('CNL')">CNL</button>
<button id="VIG" class="btn btn-sm btn-red btn-rounded" onclick="filter('VIG')">VIG</button>
<button id="GENESIS" class="btn btn-sm btn-deep-purple btn-rounded" onclick="genesis()">GENESIS</button>
<!--<button id="RED" class="btn btn-sm btn-outline-red btn-rounded" style="float: right;"-->
<!--        onclick="location.href='https://www.youtube.com/watch?v=dQw4w9WgXcQ';">CZERWONY PRZYCISK-->
<!--</button>-->

Month
<select name="month" id="month">
    <option th:each="months : ${T(java.time.Month).values()}"
            th:text="${months.getValue()}"
            th:selected="${months.getValue() == month}"
    >
    </option>
</select>
Year
<input type="number" th:value="${year}" name="year" style="width:60px" min="2020" max="2099" placeholder="year"
       required>
<button class="btn btn-sm btn-indigo btn-rounded" onclick="getPeriod()">CHANGE PERIOD</button>


<table id="dtPsr" class="table table-striped table-bordered table-sm table-hover" cellspacing="0" width="100%">

    <thead class="blue-gradient white-text">
    <tr>
        <th> Sap No</th>
        <th> Guardian</th>
        <th> Project</th>

        <th style="padding-right:0pt;  word-wrap:break-word;width:55px"> Scope</th>
        <th style="padding-right:0pt;  word-wrap:break-word;width:55px"> Schedule</th>
        <th style="padding-right:0pt;  word-wrap:break-word;width:55px"> Cost</th>
        <th> Status</th>
        <th> Company</th>
        <th> Stream</th>
        <th> Project Manager</th>
        <th> EDIT</th>
        <th> VIEW</th>
        <th> DOWNLOAD</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="psr : ${projectStatusReports}">
        <td><a th:href="@{/psr/{id}/{year}/{month}/view(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}" th:text="P+${psr.project.sapNo}"></a></td>
        <td><a th:href="@{/psr/{id}/{year}/{month}/view(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}" th:text="${psr.project.employees}"></a></td>
        <td><a th:href="@{/psr/{id}/{year}/{month}/view(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}" th:text="${psr.project.name}"></a></td>
        <td><a th:href="@{/psr/{id}/{year}/{month}/view(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}"><img th:src="'/codebase/trafficlight/'+${psr.scope.name()}+'.png'" height="55" width="55" th:alt="${psr.scope.name()}"></a></td>
        <td><a th:href="@{/psr/{id}/{year}/{month}/view(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}"><img th:src="'/codebase/trafficlight/'+${psr.schedule.name()}+'.png'" height="55" width="55" th:alt="${psr.schedule.name()}"></a></td>
        <td><a th:href="@{/psr/{id}/{year}/{month}/view(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}"><img th:src="'/codebase/trafficlight/'+${psr.cost.name()}+'.png'" height="55" width="55" th:alt="${psr.cost.name()}"></a></td>
        <td><a th:href="@{/psr/{id}/{year}/{month}/view(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}" th:text="${psr.project.status}"></a></td>
        <td><a th:href="@{/psr/{id}/{year}/{month}/view(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}" th:text="${psr.project.companies}"></a></td>
        <td><a th:href="@{/psr/{id}/{year}/{month}/view(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}" th:text="${psr.project.genesis}"></a></td>
        <td><a th:href="@{/psr/{id}/{year}/{month}/view(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}" th:text="${psr.project.projectManager}"></a></td>

        <td><a th:href="@{/psr/{id}/{year}/{month}(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}" class="btn btn-red btn-sm m-0">EDIT</a></td>
        <td><a th:href="@{/psr/{id}/{year}/{month}/view(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}" class="btn btn-blue btn-sm m-0">VIEW</a></td>
        <td><a th:href="@{/psr/{id}/{year}/{month}/view/pdf(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}" class="btn btn-amber btn-sm m-0">PDF</a>
            <a th:href="@{/psr/{id}/{year}/{month}/view/ppt(id=${psr.project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}" class="btn btn-amber btn-sm m-0">PPT</a>
        </td>
    </tr>
    </tbody>
    <tfoot>
    <tr>
        <th> Sap No</th>
        <th> Guardian</th>
        <th> Project</th>
        <th style="padding-right:0pt;  word-wrap:break-word;width:55px"> Scope</th>
        <th style="padding-right:0pt;  word-wrap:break-word;width:55px"> Schedule</th>
        <th style="padding-right:0pt;  word-wrap:break-word;width:55px"> Cost</th>
        <th> Status</th>
        <th> Company</th>
        <th> Stream</th>
        <th> Project Manager</th>
        <th> EDIT</th>
        <th> VIEW</th>
        <th> DOWNLOAD</th>
    </tr>
    </tfoot>
</table>
<br>
<hr>
<h3 style="color: red"> Missing PSR </h3>
<hr>

<table id="dtBasicExample" class="table table-striped table-bordered table-sm table-hover" cellspacing="0" width="100%">

    <thead class="ripe-malinka-gradient white-text">
    <tr>
        <th> Sap No</th>
        <th> Guardian</th>
        <th> Project</th>
        <th> Status</th>
        <th> Company</th>
        <th> Stream</th>
        <th> Project Manager</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="project : ${projects}">
        <td><a th:href="@{/projects/edit(id=${project.projectId})}" th:text="P+${project.sapNo}"></a></td>
        <td><a th:href="@{/projects/edit(id=${project.projectId})}" th:text="${project.employees}"></a></td>
        <td><a th:href="@{/projects/edit(id=${project.projectId})}" th:text="${project.name}"></a></td>
        <td><a th:href="@{/projects/edit(id=${project.projectId})}" th:text="${project.status}"></a></td>
        <td><a th:href="@{/projects/edit(id=${project.projectId})}" th:text="${project.companies}"></a></td>
        <td><a th:href="@{/projects/edit(id=${project.projectId})}" th:text="${project.genesis}"></a></td>
        <td><a th:href="@{/projects/edit(id=${project.projectId})}" th:text="${project.projectManager}"></a></td>
    </tr>
    </tbody>
    <tfoot>
    <tr>
        <th> Sap No</th>
        <th> Guardian</th>
        <th> Project</th>
        <th> Status</th>
        <th> Company</th>
        <th> Stream</th>
        <th> Project Manager</th>
    </tr>
    </tfoot>
</table>


<script>

    function reset() {
        $('#dtBasicExample').DataTable()
            .columns()
            .search("")
            .draw();
        $('#dtPsr').DataTable()
            .columns()
            .search("")
            .draw();
    }

    function filter(value) {
        reset();
        $('#dtBasicExample').DataTable()
            .column(4)
            .search(value)
            .draw();
        $('#dtPsr').DataTable()
            .column(7)
            .search(value)
            .draw();
    }

    function genesis() {
        reset();
        $('#dtBasicExample').DataTable()
            .column(5)
            .search('^((?!NOT_GENESIS).)*$', true, false)
            .draw();
        $('#dtPsr').DataTable()
            .column(8)
            .search('^((?!NOT_GENESIS).)*$', true, false)
            .draw();
    }


    $(document).ready(function () {
        $('#dtBasicExample').DataTable({
            "paging": false, // false to disable pagination (or any other option)
            dom: 'Bfrtip',
            stateSave: true,
            columnDefs: [
                {
                    targets: 1,
                    className: 'noVis'
                }
            ],
            buttons: [
                'copyHtml5',
                {
                    extend: 'excelHtml5',
                    autoFilter: true,
                    sheetName: 'More Than ACE Export'
                },
                // 'csvHtml5',
                {
                    extend: 'colvis',
                    collectionLayout: 'fixed two-column'
                }
            ],

            initComplete: function () {
                this.api().columns().every(function () {
                    var column = this;
                    var search = $(`<input class="form-control form-control-sm" type="text" placeholder="Search">`)
                        .appendTo($(column.footer()).empty())
                        .on('change input', function () {
                            var val = $(this).val()

                            column
                                .search(val ? val : '', true, false)
                                .draw();
                        });
                });
            }

        });
        $('.dataTables_length').addClass('bs-select');

        $('#dtPsr').DataTable({
            "paging": false, // false to disable pagination (or any other option)
            dom: 'Bfrtip',
            stateSave: true,
            columnDefs: [
                {
                    targets: 1,
                    className: 'noVis'
                }
            ],
            buttons: [
                'copyHtml5',
                {
                    extend: 'excelHtml5',
                    autoFilter: true,
                    sheetName: 'More Than ACE Export'
                },
                // 'csvHtml5',
                {
                    extend: 'colvis',
                    collectionLayout: 'fixed two-column'
                }
            ],

            initComplete: function () {
                this.api().columns().every(function () {
                    var column = this;
                    var search = $(`<input class="form-control form-control-sm" type="text" placeholder="Search">`)
                        .appendTo($(column.footer()).empty())
                        .on('change input', function () {
                            var val = $(this).val()

                            column
                                .search(val ? val : '', true, false)
                                .draw();
                        });
                });
            }

        });
        $('.dataTables_length').addClass('bs-select');
    });

    function getPeriod() {
        var action_src = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '') + '/psr/' + document.getElementsByName("year")[0].value +'/'+ document.getElementsByName("month")[0].value ;
        var period = document.getElementById('period');
        window.location.href = action_src;
    }
</script>

</body>
