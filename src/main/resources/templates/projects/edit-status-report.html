<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<!--    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>PROTON</title>
    <script src="/js/jquery-3.5.0.min.js"></script>
    <!-- jsPDF library -->
    <script src="/js/jspdf.min.js"></script>
    <script src="/js/html2pdf.bundle.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
    <!--<head th:replace="layouts :: header">-->
    <!-- Font Awesome -->
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <!-- Material Design Bootstrap -->
    <link href="/css/mdb.min.css" rel="stylesheet" type="text/css">
    <!-- Your custom styles (optional) -->
    <link href="/css/style.css" rel="stylesheet" type="text/css">
    <!-- DataTables CSS -->
    <link href="/css/addons/datatables.min.css" rel="stylesheet" type="text/css">
    <!-- DataTables JS -->
    <script src="/js/addons/datatables.min.js" type="text/javascript"></script>

    <!-- DataTables Select CSS -->
    <link href="/css/addons/datatables-select.min.css" rel="stylesheet" type="text/css">
    <!-- DataTables Select JS -->
    <script src="/js/addons/datatables-select.min.js" type="text/javascript"></script>
    <!-- Bootstrap tooltips -->

    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="module" src="https://unpkg.com/x-frame-bypass"></script>
    <style>
        table, td, th {
            border: 1px solid #595959;
            border-collapse: collapse;
        }

        td, th {
            padding: 3px;
            width: 133px;
            height: 25px;
        }

        .even {
            background: #fbf8f0;
        }

        .odd {
            background: #fefcf9;
        }
    </style>


</head>

<body>

<nav th:replace="layouts :: navbar"></nav>

<hr>
<h3 th:text="'PSR of '+${project.name}"> PSR </h3>
<hr>


<div class="row" style="width: 600vw; margin: 30px">
    <div class="html-content" style="width: 800px;height: 650px;">
        <div id="edit" style="width: 800px;height: 650px;">
            <form th:action="@{/psr/{id}/save(id=${project.projectId})}" th:object="${projectStatusReport}"
                  method="POST">
                <div th:if="${errorMessage}">
                    <div th:text="${errorMessage}" class="red-text"></div>
                </div>
                <button type="submit" class="btn btn-primary btn-sm mb-3"> Save PSR</button>
                <a th:href="@{/psr/{id}(id=${project.projectId})}" class="btn btn-green btn-sm mb-3"> New
                    PSR </a>
                <button type="submit" class="btn btn-amber btn-sm mb-3" onclick="resetPsrIdAndSave()"> Duplicate</button>
                Month
                <select th:field="${projectStatusReport.month}">
                    <option th:each="month : ${T(java.time.Month).values()}"
                            th:value="${month}"
                            th:text="${month.getValue()}">
                    </option>
                </select>
                <input type="hidden" th:value="${projectStatusReport.psrId}" name="psrId" id="psrId">
                Year
                <input type="number" th:field="${projectStatusReport.year}" style="width:60px" min="2020" max="2099"
                       placeholder="year"
                       required>
                <br>
                <small>
                    <i th:text="${projectStatusReport.modifiedBy!=null } ? ${ 'Last modified by '+projectStatusReport.modifiedBy+' on '+projectStatusReport.lastModifiedDate}"></i>
                </small>
                <div class="column">
                    <table class="table table-bordered table-striped">
                        <colgroup>
                            <col style="background-color:#aeea00">
                            <col span="2">
                            <col style="background-color:#ccff90">
                        </colgroup>
                        <tbody>
                        <tr>
                            <td>PROJECT DESCRIPTION:</td>
                            <td colspan="2" style="background-color:#FFFF00">COST (PLN)</td>
                            <td>PM:
                                <input type="text" name="projectManager" id="projectManager"
                                       th:value="${projectStatusReport.projectManager != null} ? ${projectStatusReport.projectManager} : ${project.projectManager}">
                        </tr>
                        <tr>
                            <td rowspan="6" th:text="${project.descriptionEn}"></td>
                            <td style="background-color:#FFFF00">REALIZED:</td>
                            <td style="background-color:#FFFF00">
                                <input type="number" th:field="${projectStatusReport.realizedBudget}" step="1">
                            </td>
                            <td rowspan="2">SCOPE
                                <select th:field="${projectStatusReport.scope}">
                                    <option th:each="scope : ${T(pl.fc.app.enities.enums.ProjectState).values()}"
                                            th:value="${scope}"
                                            th:text="${scope}">
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="background-color:#FFFF00">PLANNED:</td>
                            <td style="background-color:#FFFF00">
                                <input type="number"
                                       th:value="${projectStatusReport.plannedBudget != null} ? ${projectStatusReport.plannedBudget} : ${project.budget}"
                                       id="plannedBudget" name="plannedBudget" step="1">
                            </td>
                        </tr>
                        <tr>
                            <td style="background-color:#FFFF00">FORECAST:</td>
                            <td style="background-color:#FFFF00">
                                <input type="number" th:field="${projectStatusReport.forecastBudget}" step="1">
                            </td>
                            <td rowspan="2">SCHEDULE
                                <select th:field="${projectStatusReport.schedule}">
                                    <option th:each="schedule : ${T(pl.fc.app.enities.enums.ProjectState).values()}"
                                            th:value="${schedule}"
                                            th:text="${schedule}">
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="background-color:#64dd17" colspan="2">GO-LIVE DATE</td>
                        </tr>
                        <tr>
                            <td style="background-color:#64dd17">FROM INAUGURATION:</td>
                            <td style="background-color:#64dd17">
                                <a th:text="${project.goLivePlanned}"></a>
                            </td>
                            <td rowspan="2">COST
                                <select th:field="${projectStatusReport.cost}">
                                    <option th:each="cost : ${T(pl.fc.app.enities.enums.ProjectState).values()}"
                                            th:value="${cost}"
                                            th:text="${cost}">
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="background-color:#64dd17">PLANNED:</td>
                            <td style="background-color:#64dd17">
                                <input type="date" th:field="${projectStatusReport.projectGoLive}">
                            </td>
                        </tr>
                        <tr>
                            <td>WORKS COMPLETED
                                (last month)
                            </td>
                            <td colspan="3">
                                <textarea maxlength="255" th:field="${projectStatusReport.completedWorks1}"></textarea>
                                <textarea maxlength="255" th:field="${projectStatusReport.completedWorks2}"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <td>NEXT STEPS
                                (next month)
                            </td>
                            <td colspan="3">
                                <textarea maxlength="255" th:field="${projectStatusReport.nextSteps1}"></textarea>
                                <textarea maxlength="255" th:field="${projectStatusReport.nextSteps2}"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <td>ISSUES /RISKS &amp; MITIGATIONS</td>
                            <td colspan="3">
                                <textarea maxlength="255" th:field="${projectStatusReport.risks1}"></textarea>
                                <textarea maxlength="255" th:field="${projectStatusReport.risks2}"></textarea>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <button type="submit" class="btn btn-primary btn-sm mb-3"> Save PSR</button>
                <a th:href="@{/projects/edit(id=${project.projectId})}" class="btn btn-outline-blue btn-sm mb-3"> Edit Project </a>
            </form>
        </div>
    </div>
    <div id="editor"></div>

    <div class="column">
        <table id="dtBasicExample" class="table table-bordered table-striped" style="margin-left: 30px;">
            <thead class="aqua-gradient" style="color: white">
            <tr>
                <th> MONTH</th>
                <th> YEAR</th>
                <th> EDIT</th>
                <th> VIEW</th>
                <th> DOWNLOAD</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="psr : ${project.projectStatusReports}">
                <td>
                    <a th:href="@{/psr/{id}/{year}/{month}(id=${project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}"
                       th:text="${psr.month.getValue()}"></a></td>
                <td>
                    <a th:href="@{/psr/{id}/{year}/{month}(id=${project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}"
                       th:text="${psr.year}"></a></td>
                <td>
                    <a th:href="@{/psr/{id}/{year}/{month}(id=${project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}"
                       class="btn btn-red btn-sm m-0">EDIT</a></td>
                <td>
                    <button type="button" class="btn btn-indigo btn-sm m-0"
                            th:attr="onclick=|view('@{/psr/{id}/{year}/{month}/view(id=${project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}')|"
                    >VIEW
                    </button>
                </td>
                <td>
                    <button type="button" class="btn btn-amber btn-sm m-0"
                            th:attr="onclick=|view('@{/psr/{id}/{year}/{month}/view/pdf(id=${project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}')|"
                    >PDF
                    </button>
                    <button type="button" class="btn btn-amber btn-sm m-0"
                            th:attr="onclick=|view('@{/psr/{id}/{year}/{month}/view/ppt(id=${project.projectId}, month=${psr.month.getValue()}, year=${psr.year})}')|"
                    >PPT
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<footer th:replace="layouts :: footer"></footer>
<script>

    function resetPsrIdAndSave() {
        document.getElementById("psrId").value = 0;
    }

    $(document).ready(function () {
        $('#dtBasicExample').DataTable({
            "searching": true,
            "paging": false,
        });
    });


    function view(url) {
        url = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '') + url;
        $("#edit").html('<object data=' + url + ' style=\"width: 800px; height: 650px;\"/>');
    }

</script>

</body>
